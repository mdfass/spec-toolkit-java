<?xml version="1.0" encoding="UTF-8"?>
<specification xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
               xmlns="https://magento.com/open-specification"
               xsi:schemaLocation="https://magento.com/open-specification ../specification.xsd">

    <module name="magento.inventory">

        <service name="aggregate_stock_management">
            <summary>Stock Aggregate Management</summary>

            <event name="updated">
                <summary>Notification about any stock update from the aggregate node</summary>
                <extensible>false</extensible>
                <status>public</status>
                <arguments>
                    <argument name="snapshot">
                        <summary>Snapshot</summary>
                        <type>magento.inventory.aggregate_snapshot</type>
                        <required>true</required>
                    </argument>
                </arguments>
            </event>

            <command name="request_reservation">
                <summary>Reservation of a set of skus in a Stock Aggregate</summary>
                <description>
                    The reservation will hold in-flight sku quantities when reindexing and exporting a stock snapshot to the selling channels.
                </description>
                <extensible>true</extensible>
                <status>public</status>
                <arguments>
                    <argument name="aggregate_id">
                        <summary>Stock Aggregate ID</summary>
                        <type>string</type>
                        <required>true</required>
                    </argument>
                    <argument name="uuid">
                        <summary>Reservation UUID</summary>
                        <type>string</type>
                        <required>true</required>
                    </argument>
                    <argument name="lines">
                        <summary>Reservation lines</summary>
                        <type>array[magento.inventory.reservation_line]</type>
                        <required>true</required>
                    </argument>
                </arguments>
            </command>

            <event name="reservation_confirmed">
                <summary>Notification about the status of a requested stock reservation</summary>
                <description>
                    This event will indicate whether stock was avialable in the aggregate at the moment of requesting the reservation. The in-flight will be set even in case stock was not available, to ensure the next reindex is accounting for such in-flight items before generating the stock export.
                </description>
                <extensible>true</extensible>
                <status>public</status>
                <arguments>
                    <argument name="aggregate_id">
                        <summary>Stock Aggregate ID</summary>
                        <type>string</type>
                        <required>true</required>
                    </argument>
                    <argument name="uuid">
                        <summary>Reservation UUID</summary>
                        <type>string</type>
                        <required>true</required>
                    </argument>
                    <argument name="lines">
                        <summary>Reservation lines and their status</summary>
                        <type>array[magento.inventory.reservation_line_status]</type>
                        <required>true</required>
                    </argument>
                </arguments>
            </event>

            <command name="cancel_reservation">
                <summary>Cancel the reservation of a set of skus in a Stock Aggregate</summary>
                <description>
                    The soft in-flights will be removed.
                </description>
                <extensible>true</extensible>
                <status>public</status>
                <arguments>
                    <argument name="aggregate_id">
                        <summary>Stock Aggregate ID</summary>
                        <type>string</type>
                        <required>true</required>
                    </argument>
                    <argument name="uuid">
                        <summary>Reservation UUID</summary>
                        <type>string</type>
                        <required>true</required>
                    </argument>
                    <argument name="lines">
                        <summary>Reservation lines</summary>
                        <type>array[magento.inventory.reservation_line]</type>
                        <required>true</required>
                    </argument>
                </arguments>
            </command>
        </service>

        <struct name="reservation_line">
            <summary>Sku and Quantity</summary>
            <description>
                Quantity of items from a given Sku that will be reserved
            </description>
            <extensible>true</extensible>
            <properties>
                <property name="sku">
                    <summary>The sku of the product</summary>
                    <type>string</type>
                    <required>true</required>
                </property>
                <property name="quantity">
                    <summary>Quantity of items to reserve</summary>
                    <type>integer</type>
                    <required>true</required>
                </property>
            </properties>
        </struct>

        <struct name="reservation_line_status">
            <summary>Sku, Quantity and stock information</summary>
            <description>
                Information about the existence or not of stock for a given quantity of a given Sku
            </description>
            <extensible>true</extensible>
            <properties>
                <property name="sku">
                    <summary>The sku of the product</summary>
                    <type>string</type>
                    <required>true</required>
                </property>
                <property name="quantity">
                    <summary>Quantity of items reserved</summary>
                    <type>integer</type>
                    <required>true</required>
                </property>
                <property name="in_stock">
                    <summary>Indicator of stock availablility at the moment of the reservation</summary>
                    <type>boolean</type>
                    <required>true</required>
                </property>
            </properties>
        </struct>

        <service name="aggregate_stock_repository">
            <summary>Stock Aggregate Repository</summary>

            <query name="search">
                <summary>Search aggregated stock</summary>
                <description>IMPORTANT: the maximum number of accepted criterias is 1000 (in case you are using both the sku and aggregate as criterias, the multiplication of the sku * aggregate parameters shouldn't exceed 1000 values)</description>
                <extensible>false</extensible>
                <status>public</status>
                <arguments>
                    <argument name="query">
                        <summary>Search query</summary>
                        <type>magento.common.query</type>
                        <required>true</required>
                    </argument>
                </arguments>
                <returns>magento.inventory.aggregate_stock_collection</returns>
                <searchable_fields>
                    <field name="aggregate_id">
                        <summary>Aggregate Id</summary>
                    </field>
                    <field name="sku">
                        <summary>SKU</summary>
                    </field>
                </searchable_fields>
            </query>

            <query name="search_history">
                <summary>Find aggregate stock history by criteria.</summary>
                <description>IMPORTANT: the maximum number of accepted criterias is 1000 (in case you are using both the sku and aggregate as criterias, the multiplication of the sku * aggregate parameters shouldn't exceed 1000 values)</description>
                <extensible>false</extensible>
                <status>public</status>
                <arguments>
                    <argument name="query">
                        <summary>Query</summary>
                        <type>magento.common.query</type>
                        <required>true</required>
                    </argument>
                </arguments>
                <returns>magento.inventory.aggregate_stock_history_collection</returns>
                <searchable_fields>
                    <field name="aggregate_id">
                        <summary>Aggregate Id [Required]</summary>
                    </field>
                    <field name="sku">
                        <summary>SKU [Required]</summary>
                    </field>
                </searchable_fields>
            </query>
        </service>

        <struct name="aggregate_stock">
            <summary>Aggregated stock</summary>
            <description>
                Aggregated stock represents available stock to sell in a certain channel
            </description>
            <extensible>true</extensible>
            <properties>
                <property name="aggregate_id">
                    <summary>The aggregate identifier which this stock belongs to</summary>
                    <type>string</type>
                    <required>true</required>
                </property>
                <property name="sku">
                    <summary>The sku of the product</summary>
                    <type>string</type>
                    <required>true</required>
                </property>
                <property name="quantity">
                    <summary>The units of the product available</summary>
                    <type>integer</type>
                    <required>true</required>
                </property>
                <property name="in_stock">
                    <summary>If the product is in stock or not</summary>
                    <description>A flag to mark if the product it's in stock or not, independently of the number of
                        units available
                    </description>
                    <type>boolean</type>
                    <required>false</required>
                </property>
                <property name="safety_stock">
                    <summary>Number of units that we don't take into consideration</summary>
                    <description>The number of units available that we don't want to take into consideration when
                        selling online, as an internal buffer for avoiding possible oversells
                    </description>
                    <type>integer</type>
                    <required>false</required>
                </property>
                <property name="unlimited">
                    <summary>This sku has unlimited stock in this aggregate (quantity is ignored)</summary>
                    <type>boolean</type>
                    <required>false</required>
                </property>
                <property name="inflight">
                    <summary>Quantity of the items which are in inflight (only for searching purposes)</summary>
                    <type>integer</type>
                    <required>false</required>
                </property>
                <property name="inflight_backorders">
                    <summary>Quantity of the items which are in inflight because of Backordered Orders</summary>
                    <type>integer</type>
                    <required>false</required>
                </property>
            </properties>
        </struct>

        <struct name="aggregate_snapshot">
            <summary>Aggregate Snapshot</summary>
            <description>
                Snapshot represents an array of SKUs with their quantities captured at certain moment of time.
            </description>
            <extensible>false</extensible>
            <properties>
                <property name="aggregate_id">
                    <summary>The identifier of the aggregate node which owns the stock quantities</summary>
                    <type>string</type>
                    <required>true</required>
                </property>
                <property name="mode">
                    <summary>Snapshot Mode (FULL, NONZERO, DELTA)</summary>
                    <type>magento.inventory.snapshot_mode</type>
                    <required>true</required>
                </property>
                <property name="created_on">
                    <summary>Date and time when snapshot was created</summary>
                    <type>datetime</type>
                    <required>true</required>
                </property>
                <property name="stock">
                    <summary>Array of SKUs in snapshot</summary>
                    <type>array[magento.inventory.aggregate_snapshot_sku]</type>
                    <required>true</required>
                </property>
            </properties>
        </struct>

        <struct name="aggregate_snapshot_sku">
            <summary>An entry in aggregate snapshot</summary>
            <description>Pair of SKU and Quantity</description>
            <extensible>false</extensible>
            <properties>
                <property name="sku">
                    <summary>SKU</summary>
                    <type>string</type>
                    <required>true</required>
                </property>
                <property name="quantity">
                    <summary>Quantity</summary>
                    <type>integer</type>
                    <required>true</required>
                </property>
                <property name="unlimited">
                    <summary>This sku has unlimited stock (quantity is ignored)</summary>
                    <type>boolean</type>
                    <required>false</required>
                </property>
                <property name="inflight_backorders">
                    <summary>Inflight Backorders</summary>
                    <type>integer</type>
                    <required>false</required>
                </property>
            </properties>
        </struct>
        <struct name="aggregate_stock_collection">
            <summary>Aggregate stock collection for Search result</summary>
            <description>Array of aggregate stock with offset, size and total items</description>
            <extensible>false</extensible>
            <properties>
                <property name="offset">
                    <summary>The offset of the search</summary>
                    <type>integer</type>
                    <required>true</required>
                </property>
                <property name="size">
                    <summary>The size of the searched chunk returned</summary>
                    <type>integer</type>
                    <required>true</required>
                </property>
                <property name="total">
                    <summary>Number of total items that search result has</summary>
                    <type>integer</type>
                    <required>true</required>
                </property>
                <property name="items">
                    <summary>The items found by search query</summary>
                    <type>array[magento.inventory.aggregate_stock]</type>
                    <required>true</required>
                </property>
            </properties>
        </struct>

        <struct name="aggregate_stock_history_collection">
            <summary>Aggregate Stock History Collection</summary>
            <extensible>false</extensible>
            <properties>
                <property name="offset">
                    <summary>The offset of the search</summary>
                    <type>integer</type>
                    <required>true</required>
                </property>
                <property name="size">
                    <summary>The size of the searched chunk returned</summary>
                    <type>integer</type>
                    <required>true</required>
                </property>
                <property name="total">
                    <summary>Number of total items that search result has</summary>
                    <type>integer</type>
                    <required>true</required>
                </property>
                <property name="items">
                    <summary>The items found by search query</summary>
                    <type>array[magento.inventory.aggregate_stock_history]</type>
                    <required>true</required>
                </property>
            </properties>
        </struct>

        <struct name="aggregate_stock_history">
            <summary>Aggregate Stock History For a Sku</summary>
            <extensible>false</extensible>
            <properties>
                <property name="aggregate_id">
                    <summary>The aggregate identifier which this stock belongs to</summary>
                    <type>string</type>
                    <required>false</required>
                </property>
                <property name="sku">
                    <summary>The sku of the product</summary>
                    <type>string</type>
                    <required>false</required>
                </property>
                <property name="date">
                    <summary>Date of the stock update</summary>
                    <type>datetime</type>
                    <required>false</required>
                </property>
                <property name="reason">
                    <summary>Reason of the stock update</summary>
                    <type>string</type>
                    <required>false</required>
                </property>
                <property name="quantity">
                    <summary>Quantity</summary>
                    <type>integer</type>
                    <required>false</required>
                </property>
                <property name="unlimited">
                    <summary>Unlimited</summary>
                    <type>boolean</type>
                    <required>false</required>
                </property>
            </properties>
        </struct>

        <enum name="snapshot_mode">
            <value>DELTA</value>
            <value>FULL</value>
            <value>NONZERO</value>
        </enum>

    </module>

</specification>
