<?xml version="1.0" encoding="UTF-8"?>
<specification xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
               xmlns="https://magento.com/open-specification"
               xsi:schemaLocation="https://magento.com/open-specification ../specification.xsd">
    <module name="magento.source_engine">

        <service name="sourcing_processed_orders_repository">
            <summary>Repository for order data of requests that have been submitted</summary>

            <query name="find">
                <summary>Fetch details of an order</summary>
                <extensible>false</extensible>
                <status>draft</status>
                <arguments>
                    <argument name="uuid">
                        <summary>The UUID of the required order</summary>
                        <type>string</type>
                        <required>true</required>
                    </argument>
                </arguments>
                <returns>magento.source_engine.sourcing_processed_order</returns>
            </query>
        </service>

        <service name="sourcing_processed_requests_repository">
            <summary>Repository for information on the requests the sourcing engine has received</summary>
            <query name="find">
                <summary>Fetch details of a specific request</summary>
                <extensible>false</extensible>
                <status>draft</status>
                <arguments>
                    <argument name="uuid">
                        <summary>The UUID of the required order</summary>
                        <type>string</type>
                        <required>true</required>
                    </argument>
                </arguments>
                <returns>magento.source_engine.sourcing_processed_request</returns>
            </query>
        </service>

        <struct name="context_entry">
            <summary>Context data relating to the sourcing request</summary>
            <description>
                Context data that is used by the source engine to calculate the sourcing options.
            </description>
            <extensible>false</extensible>
            <properties>
                <property name="timestamp">
                    <summary>The time when the entry was made</summary>
                    <type>datetime</type>
                    <required>true</required>
                </property>
                <property name="type">
                    <summary>The entry type, which describes the type of data to expect</summary>
                    <type>string</type>
                    <required>true</required>
                </property>
                <property name="data">
                    <summary>The context data</summary>
                    <description>
                        The data is a free-formed map that is dependent on the type, and frequently changes.
                    </description>
                    <type>string</type>
                    <required>true</required>
                </property>
            </properties>
        </struct>

        <struct name="sourcing_status_entry">
            <summary>A specific status update made during the processing of a sourcing request</summary>
            <extensible>false</extensible>
            <properties>
                <property name="timestamp">
                    <summary>The time when the entry was made</summary>
                    <type>datetime</type>
                    <required>true</required>
                </property>
                <property name="status_moniker">
                    <summary>
                        The status name/monikier
                    </summary>
                    <description>
                        An enumerated status entry - indicating the processing step involved.
                        This value is tied closely to the structure of Sorcerer and may not
                        be valuable externally (see 'state').
                    </description>
                    <type>string</type>
                    <required>false</required>
                </property>
                <property name="state">
                    <summary>
                        The external state
                    </summary>
                    <description>
                        An enumerated "external" state associated with this entry.
                        This a state value that's more understandable to the "outside" world.
                        One of the following values: RECEIVED, QUEUED, CANCELLED, PROCESSING,
                        RESPONDED, ERROR, UNKNOWN
                    </description>
                    <type>string</type>
                    <required>false</required>
                </property>
                <property name="type">
                    <summary>The entry type</summary>
                    <type>string</type>
                    <required>false</required>
                </property>
            </properties>
        </struct>

        <struct name="sourcing_processed_request">
            <summary>The sourcing engine's limited view of an order</summary>
            <extensible>false</extensible>
            <properties>
                <property name="uuid">
                    <summary>The UUID of the request supplied by MCOM</summary>
                    <type>string</type>
                    <required>true</required>
                </property>
                <property name="order_uuid">
                    <summary>The UUID of the order for which this request was made</summary>
                    <type>string</type>
                    <required>true</required>
                </property>
                <property name="received_on">
                    <summary>The time when the request was received by the sourcing engine</summary>
                    <type>datetime</type>
                    <required>true</required>
                </property>
                <property name="last_updated_on">
                    <summary>The time when the request was last update by the sourcing engine</summary>
                    <type>datetime</type>
                    <required>true</required>
                </property>
                <property name="state">
                    <summary>State</summary>
                    <description>
                        The current processing state of the request. One of the following values:
                        RECEIVED, QUEUED, CANCELLED, PROCESSING, RESPONDED, ERROR, UNKNOWN
                    </description>
                    <type>string</type>
                    <required>true</required>
                </property>
                <property name="wave_id">
                    <summary>Wave UUID</summary>
                    <description>The UUID of the wave this sourcing request belongs to (generated by the sourcing engine)</description>
                    <type>string</type>
                    <required>false</required>
                </property>
                <property name="sourcing_response">
                    <summary>The sourcing response returned by srcrr.</summary>
                    <description>The sourcing response returned by srcrr. If null, this has not been sourced.</description>
                    <type>magento.source_engine.sourcing_response</type>
                    <required>false</required>
                </property>
                <property name="status_entries">
                    <summary>The status entries made during request processing</summary>
                    <description>
                        This helps determine what part of processing the sourcing request has completed
                    </description>
                    <type>array[magento.source_engine.sourcing_status_entry]</type>
                    <required>true</required>
                </property>
                <property name="context_entries">
                    <summary>Contextual data used by the source engine</summary>
                    <description>
                        The type of data varies, some of it is generated/calculated within
                        the sourcing engine (e.g. "activeSources") while other context entries
                        might have come from external services (e.g. "sourceDetails")
                    </description>
                    <type>array[magento.source_engine.context_entry]</type>
                    <required>true</required>
                </property>
            </properties>
        </struct>

        <struct name="sourcing_processed_request_overview">
            <summary>Overview data on a processed request</summary>
            <description>
                Contains abbreviated request information appropiate for an overview of
                all the processed requests attached to a processed order.
            </description>
            <extensible>false</extensible>
            <properties>
                <property name="uuid">
                    <summary>Request UUID</summary>
                    <type>string</type>
                    <required>true</required>
                </property>
                <property name="state">
                    <summary>The state of the request</summary>
                    <description>
                      The current processing state of the request. One of the following values:
                      RECEIVED, QUEUED, CANCELLED, PROCESSING, RESPONDED, ERROR, UNKNOWN
                    </description>
                    <type>string</type>
                    <required>true</required>
                </property>
                <property name="received_on">
                	<summary>The date/time of request receipt</summary>
                	<type>datetime</type>
                	<required>true</required>
                </property>
            </properties>
        </struct>

        <struct name="sourcing_processed_order">
            <summary>The sourcing engine's limited view of an order</summary>
            <extensible>false</extensible>
            <properties>
                <property name="uuid">
                    <summary>The UUID of the order supplied by MCOM</summary>
                    <type>string</type>
                    <required>true</required>
                </property>
                <property name="number_of_requests">
                    <summary>The number of sourcing requests made for this order</summary>
                    <type>integer</type>
                    <required>true</required>
                </property>
                <property name="sourcing_request_overviews">
                    <summary>The UUIDs of the requests made for this order</summary>
                    <type>array[magento.source_engine.sourcing_processed_request_overview]</type>
                    <required>true</required>
                </property>
            </properties>
        </struct>

    </module>
</specification>
